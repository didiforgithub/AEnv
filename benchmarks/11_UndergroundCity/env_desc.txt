# Subterranean Megacity Environment Design Document

## Background

The Subterranean Megacity environment simulates the challenging role of chief urban planner for an underground civilization. Unlike surface cities that follow familiar gravitational and structural principles, this subterranean world operates under a completely alien set of physical laws that defy conventional engineering wisdom. The underground realm features inverted gravity gradients that can pull structures sideways along mineral veins, counterintuitive load distribution where removing material in one location might actually strengthen distant areas, and cyclical airflow patterns that reverse direction periodically. These anomalous physics create a learning environment where agents must abandon preconceived notions about construction and instead develop entirely new strategies through experimentation and observation. The setting emphasizes the tension between expansion ambitions and the fundamental survival needs of maintaining structural stability, breathable air circulation, and adequate power distribution throughout the growing underground settlement.

## Objective

The agent's primary mission involves transforming a modest underground outpost into a thriving subterranean megacity containing six fully operational districts within exactly 40 construction steps. Success requires simultaneously managing three critical sustainability metrics while pursuing aggressive expansion goals. Structural integrity must remain consistently above 80 percent to ensure citizen safety and prevent catastrophic collapse scenarios. The breathable-air index must stay above 60 percent to maintain livable conditions as the population grows and oxygen demands increase. Additionally, all construction and operational activities must remain within the allocated power budget, creating strategic resource allocation decisions. The objective deliberately creates competing priorities where rapid expansion might compromise safety metrics, forcing agents to discover optimal balance points through the lens of the environment's unique physical laws.

## State Setup

Each episode initializes with a carefully structured state that provides sufficient information for strategic decision-making while maintaining consistent difficulty progression across different levels. The environment begins with a 5x5 grid representing the underground region, where each cell contains initial rock stress values ranging from 0 to 100, distributed according to realistic geological patterns but varying between episodes to ensure diverse learning scenarios. Airflow vector fields are established across the same grid, indicating both direction and magnitude of air currents that will influence ventilation planning. The settlement starts with zero districts constructed, structural integrity at 100 percent, breathable-air index at 85 percent, and power storage at 50 units. A basic set of construction components is initially available, with additional advanced materials and techniques unlocked through research actions. The rock stress map reflects underlying mineral compositions and geological fault lines that determine how the anomalous gravity gradients will behave, while the airflow field establishes the baseline circulation patterns before the eight-step reversal cycles begin.

## Actions

The agent selects from seven distinct action types each step, with each action requiring specific parameters that directly influence outcomes. Excavate cell actions target individual grid locations and remove rock material while potentially triggering stress redistribution according to the underground physics model. Place support column actions require both material selection and precise positioning, with different materials exhibiting varying responses to the sideways gravity effects along mineral seams. Dig ventilation shaft actions involve choosing a starting cell and directional vector, creating air circulation pathways that interact with the cyclical airflow reversals. Install power conduit actions allow agents to specify paths up to three contiguous cells, establishing energy distribution networks that can amplify or dampen local gravity fields depending on placement relative to geological features. Build district core actions convert previously excavated chambers into habitable districts, requiring adequate structural support and air circulation to activate successfully. Research anomaly actions gradually reveal the mathematical relationships governing the environment's unique physics, providing crucial knowledge for advanced planning strategies. Wait or diagnostic scan actions provide opportunities to observe current system states without triggering major changes, revealing hidden stress concentrations and airflow patterns that inform future decisions.

## State Transition Rule  

State transitions follow deterministic physics equations that remain constant across all episodes, ensuring consistent learnability while incorporating realistic complexity. When agents excavate cells, the removal of rock material triggers stress redistribution calculations based on the counterintuitive load transfer mechanics, where removed weight might actually reduce stress in distant locations connected through mineral seam networks. Support column placement immediately affects local structural integrity values according to material properties and positioning relative to the inverted gravity gradients that pull sideways rather than downward. Ventilation shaft construction modifies airflow vector fields permanently, but these modifications interact with the eight-step cyclical reversal pattern that flips predominant air current directions, creating dynamic circulation scenarios. Power conduit installation establishes energy pathways while simultaneously influencing gravity field strength in adjacent cells, creating feedback loops between power distribution and structural stability. District core construction converts excavated spaces into population centers, increasing oxygen consumption rates and power demands while contributing to overall city functionality metrics. Research actions progressively unlock knowledge about the physics equations themselves, providing agents with increasingly sophisticated understanding of cause-and-effect relationships. Each transition preserves complete state observability while introducing realistic delays and cascading effects that mirror complex engineering projects.

## Rewards

The environment employs a cumulative reward structure designed to encourage both immediate progress and long-term strategic planning through multiple complementary incentive mechanisms. Structural improvements generate +2 points per percentage point increase compared to the previous step, encouraging proactive maintenance and reinforcement activities. Breathable-air index improvements provide +1 point per percentage point increase, promoting effective ventilation system development. Successfully activated district cores award +5 points each, directly rewarding expansion progress while requiring agents to solve the prerequisite infrastructure challenges. Achieving power storage above 80 units for the first time in an episode grants +3 points, encouraging efficient energy management strategies. Research actions that fully decode anomalous physics rules contribute +4 points each, incentivizing knowledge acquisition that enables more sophisticated planning approaches. Continuous operation bonuses provide +0.5 points per step when both structural integrity exceeds 80 percent and air index surpasses 60 percent, rewarding sustained excellence in city management. A substantial +40 bonus activates when agents successfully create six-district cities while maintaining all sustainability thresholds by step 40, providing a clear victory condition. Negative feedback mechanisms include -2 points per percentage point below 80 percent structural integrity and -1 point per percentage point below 60 percent air index, creating meaningful consequences for allowing conditions to deteriorate. Catastrophic structural failure triggers an immediate -40 point penalty and episode termination, establishing absolute safety boundaries.

## Observation

The observation system provides comprehensive information designed to support effective learning while maintaining appropriate challenge levels through strategic information presentation. Agents receive complete visibility into current district counts, structural integrity percentages, breathable-air index values, and power storage levels, ensuring fundamental city management decisions can be made with adequate information. The 5x5 rock stress map reveals current stress concentrations across all grid cells, displaying values from 0 to 100 that indicate both immediate hazards and opportunities for strategic excavation or reinforcement. Airflow vector fields show both direction and magnitude of air currents throughout the underground space, providing essential data for ventilation planning while requiring agents to account for the eight-step reversal cycles through observation and experience. The system displays currently available construction components along with their anomalous physical descriptors, gradually expanding this library as research actions unlock new materials and techniques. Importantly, the observation system never directly reveals the underlying physics equations governing gravity gradients, load transfer mechanics, or airflow interactions, requiring agents to infer these relationships through experimentation and pattern recognition. This design choice ensures that learning occurs through genuine discovery rather than simple rule memorization, while still providing sufficient observational detail to make meaningful progress possible. The information hierarchy emphasizes actionable signals such as stress concentration patterns and airflow bottlenecks that guide strategic decision-making, while maintaining the mystery around causal mechanisms that creates the core learning challenge.

## Termination

Episode termination occurs under three specific conditions that establish clear boundaries for both catastrophic failure and natural conclusion scenarios. Immediate termination with maximum negative penalties occurs if structural integrity drops to zero percent, representing complete city collapse and total mission failure. Similarly, if the breathable-air index reaches zero percent, the episode terminates immediately as the underground settlement becomes uninhabitable. The primary termination condition involves reaching the 40-step limit, which occurs regardless of current city status or goal achievement, creating a fixed planning horizon that requires agents to balance speed with sustainability throughout the entire episode. This time-bounded structure prevents agents from adopting overly conservative strategies that might achieve perfect safety metrics but fail to accomplish meaningful expansion goals. The termination system supports the cumulative reward structure by allowing agents to continue earning points up until the final step, encouraging sustained excellence rather than early satisfaction with minimal achievements. Unlike binary reward environments where success immediately ends episodes, this cumulative system maintains engagement through the full 40-step duration while still providing clear victory conditions through the substantial completion bonuses.

## Special Features

The environment incorporates several unique mechanisms that distinguish it from conventional construction or city-building scenarios while maintaining the learnability principles essential for effective reinforcement learning applications. The inverted gravity gradient system creates zones where structural loads transfer sideways along mineral seams rather than following traditional downward weight distribution, requiring agents to develop entirely new intuitions about support placement and load management. Counterintuitive load transfer mechanics mean that removing material through excavation can actually increase structural stability in distant locations, creating complex optimization puzzles where the obvious solution might be counterproductive. The cyclical airflow reversal mechanism introduces temporal dynamics where optimal ventilation strategies must account for predictable but dramatic changes in air current directions every eight steps. Power conduit placement creates gravity field interactions that influence structural integrity calculations, establishing feedback loops between energy infrastructure and construction stability that require sophisticated planning approaches. The research system gradually reveals the mathematical relationships underlying these anomalous physics, providing a knowledge progression pathway that enables increasingly advanced strategies as agents gain experience. All physics equations remain completely consistent across episodes and difficulty levels, with variation introduced solely through initial map conditions such as starting stress distributions and airflow patterns. This consistency ensures that learned strategies remain applicable across different scenarios while still providing sufficient environmental diversity to prevent overfitting to specific configurations. The 40-step time limit creates urgency that prevents excessive experimentation while still allowing adequate opportunity for both learning and execution of successful strategies.